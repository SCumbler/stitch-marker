<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">

<!-- <link rel="import" href="../../bower_components/iron-icons/editor-icons.html"> -->


<!--

Example:

    <sm-char-picker></sm-char-picker>

    <sm-char-picker char="{{selectedChar}}"></sm-char-picker>

    <sm-char-picker column-count=5 char-list='["a", "b"]'></sm-char-picker>

### Styling

The following custom properties and mixins are available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--paper-swatch-picker-color-size` | The size of each of the color boxes | `20px`
`--paper-swatch-picker-icon-size` | The size of the color picker icon | `24px`
`--paper-swatch-picker-icon` | Mixin applied to the color picker icon | `{}`

-->

<dom-module id="sm-char-picker">
  <template>
    <style>
      :host {
        display: inline-block;
        position: relative;
      }

      :host(:focus) {
        outline: none;
      }

      .char {
        box-sizing: border-box;
        width: var(--paper-swatch-picker-color-size, 20px);
        height: var(--paper-swatch-picker-color-size, 20px);
        display: inline-block;
        padding: 0;
        margin: 0;
        cursor: pointer;
        position: relative;

        text-align: center;
      }

      .char:hover, .char:focus {
        -webkit-transform: scale(1.3, 1.3);
        transform: scale(1.3, 1.3);
        outline: none;
        z-index: 1;
      }

      paper-button {
        min-width: 3em;
        color: white;
      }

      paper-item {
        --paper-item: {
          margin: 0;
          padding: 0;
          min-height: 0;
        };

        --paper-item-focused-before: {
          opacity: 0;
        };
      }

      paper-listbox {
        padding: 5px 10px;
        font-size: 0;
        overflow: hidden;
        @apply --layout-horisontal;
        @apply --layout-wrap;
      }
    </style>

    <paper-menu-button vertical-align="[[verticalAlign]]" horizontal-align="[[horizontalAlign]]">
      <paper-button
        id="iconButton"
        slot="dropdown-trigger" alt="char picker"
        raised
        noink$="[[noink]]">
        {{char}}
      </paper-button>
      <paper-listbox class="dropdown-content" id="container">
        <template is="dom-repeat" items="{{charList}}">
          <paper-item class="char">{{item}}</paper-item>
        </template>
      </paper-listbox>
    </paper-menu-button>
  </template>
  <script>
    Polymer({
      is: 'sm-char-picker',
      hostAttributes: {
        'tabindex': 0
      },
      listeners: {
        'iron-select': '_onCharTap'
      },
      /**
       * Fired when a color has been selected
       *
       * @event char-picker-selected
       */
      properties: {

        char: {
          type: String,
          notify: true
        },
        color: {
          type: String,
          notify: true,
          observer: '_colorChanged'
        },

        charList: {
          type: Array,
          value: function() {
            return "ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890#@$%?!*".split('');
          }
        },
        /* The number of columns to display in the picker. This corresponds to
         * the number of generic colors (i.e. not counting the light/dark) variants
         * of a specific color) you are using in your `colorList`. For example,
         * the Material Design palette has 18 colors */
        columnCount: {
          type: Number,
          value: 18
        },
        /**
         * The orientation against which to align the menu dropdown
         * horizontally relative to the dropdown trigger.
         */
        horizontalAlign: {
          type: String,
          value: 'right',
          reflectToAttribute: true
        },
        /**
         * The orientation against which to align the menu dropdown
         * vertically relative to the dropdown trigger.
         */
        verticalAlign: {
          type: String,
          value: 'top',
          reflectToAttribute: true
        },
        /**
         * If true, the color picker button will not produce a ripple effect when interacted
         * with via the pointer.
         */
        noink: {
          type: Boolean
        }
      },
      created: function() {
        // Note: we won't actually render these color boxes unless the menu is
        // actually tapped.
        this._renderedColors = false;
      },
      attached: function() {
        // Fit the color boxes in columns. We first need to get the width of
        // a color box (which is customizable), and then change the box's
        // width to fit all the columns.
        var sizeOfAColorDiv = this.getComputedStyleValue('--paper-swatch-picker-color-size');
        if (!sizeOfAColorDiv || sizeOfAColorDiv == '') {  // Default value case
          sizeOfAColorDiv = 20;
        } else {
          sizeOfAColorDiv = sizeOfAColorDiv.replace('px', '');
        }
        var rowCount = Math.ceil(this.charList.length / this.columnCount);
        this.$.container.style.height = rowCount * sizeOfAColorDiv + 'px';
        this.$.container.style.width = this.columnCount * sizeOfAColorDiv + 'px';
      },
      _addOverflowClass: function() {
        this.$.container.toggleClass('opened', true);
      },
      _removeOverflowClass: function() {
        this.$.container.toggleClass('opened', false);
      },
      _onCharTap: function(event) {
        var item = event.detail.item;
        var char = item.innerHTML;
        // If it's in rgb format, convert it first.
        this.char = item.innerHTML;
        this.fire('char-picker-selected', {char: this.char});
      },
      _colorChanged: function() {
        this.$.iconButton.style.background = this.color;
      }
    });
  </script>
</dom-module>